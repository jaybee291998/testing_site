{% extends 'base.html' %}
{% block title %}
	List App
{% endblock %}
{% block content %}
	<div id="create-update-div">
		<h1>Create</h1>
		<label for="name">Name:</label>
		<input type="text" name="title" maxlength="64" required id="name">
		<br>
		<textarea id="content-textarea">
			hi
		</textarea>
		<button id="post-btn">Post</button>
		<button id="update-btn">Update</button>
	</div>

	<div id="list-div">
		<h1>List</h1>
		<input type="text" name="search-bar" id="search-bar" placeholder="search">
		<div id="table-div">
		</div>
	</div>

	<div id="detail-div">
		<h1>Detail</h1>
	</div>

	<div id="delete-div">
		<h1>Delete</h1>
	</div>
	{% load static %}
	<script src="https://cdn.tiny.cloud/1/u9jme0ubzunc1ikuzefidbdc7pnodyglzq5mnqh5tkss5lui/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
	<script type="text/javascript" src="{% static 'js/ui.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/api.js' %}"></script>
	<script type="text/javascript">
// initialize tiny mce
		tinymce.init({
		    selector: '#content-textarea',
			plugins: '',
			toolbar: 'a11ycheck addcomment showcomments casechange checklist code export formatpainter pageembed permanentpen table',
			toolbar_mode: 'floating', 
			tinycomments_mode: 'embedded',
			tinycomments_author: 'Author name', 
		});


		const post_domain = '{{list_api}}';
		const detail_domain = '{{detail_api}}';
		const csrf_token = getCookie('csrftoken');

		const createUpdateDiv = document.getElementById('create-update-div');
		const listDiv = document.getElementById('list-div');
		const detailDiv = document.getElementById('detail-div');
		const updateDiv = document.getElementById('update-div');
		const deleteDiv = document.getElementById('delete-div');
		const tableDiv = document.getElementById('table-div');

		const divList = [createUpdateDiv, listDiv, detailDiv, deleteDiv];

		const nameInput = document.getElementById('name');

		// buttons 
		const postBtn = document.getElementById('post-btn');
		const updateBtn = document.getElementById('update-btn');

		// bind buttons to certain actions
		postBtn.onclick = postAction;

		function showDiv(div_to_show){
			return showDivBase(div_to_show, divList);
		}

		// get the data from the form
		// return a dictionary that contains the label and value
		function getFormData(){
			const data = {
				name: nameInput.value,
				content: tinymce.get('content-textarea').getContent()
			}
			return data;
		}

		// set the content of the form
		function setFormData(name, content){
			nameInput.value = name;
			tinymce.get('content-textarea').setContent(content)
		}

		// just a wrapper that uses the setFormData to clear the form
		function clearForm(){
			setFormData('', '');
		}

		async function postAction(e){
			const formData = getFormData();
			const data = post(formData);
			console.log(data);
			clearForm();
		}

		// wrapper for post
		async function post(formData){
			return await post_update(post_domain, 'POST', formData, csrf_token);
		}

		async function update(formData, pk){
			return await post_update(`${detail_domain}/${pk}`, 'PUT', formData, csrf_token);
		}

		showDiv(createUpdateDiv);
	</script>
{% endblock %}